<!DOCTYPE html>
<html lang="en" class="ba">
  <head>
    <title>TotalFinder Injection Troubles</title>
    <link rel="canonical" href="https://totalfinder.binaryage.com/injection-troubles"/>
    <link rel="shortcut icon" href="https://static.binaryage.com/5604bda0_favicon.ico" type="image/x-icon"/>
    <link rel="icon" href="https://static.binaryage.com/5604bda0_favicon.ico" type="image/x-icon"/>
    <link rel="stylesheet" href="https://static.binaryage.com/493de12c_shared_css_site.css" type="text/css"/>
    <link rel="stylesheet" href="https://static.binaryage.com/c97e55de_shared_css_github-markdown.css" type="text/css"/>
    <script src="//ajax.googleapis.com/ajax/libs/webfont/1/webfont.js"></script>
    <script>WebFont.load({google:{families:["Play:400,700:latin"]}})</script>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="google-site-verification" content="N_xzdr6ymSUQFhAEvQg7f-sp1JAeJCdW2JuaRg-da0w"/>
    <meta property="fb:admins" content="antonin.hildebrand"/>
    <link href="https://feeds.feedburner.com/binaryage-blog" type="application/atom+xml" rel="alternate" title="Ideas from BinaryAge"/>
    <script>function defer$(e){window.jQuery?e():setTimeout(function(){defer$(e)},50)}</script>
  </head>
  <body id="page-totalfinder-injection-troubles" class="site-totalfinder">
    <div id="header">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="relativize">
              <a href="//www.binaryage.com" title="BinaryAge Software">
                <div class="binaryage-logo">
                  <svg class="logo">
                    <g class="logo-badge">
                      <rect class="logo-badge-background" x="0" y="0" rx="4" ry="4" width="60" height="54"/>
                      <path class="logo-letter-b" d=" M6,47 L6,17 12,17 12,25 29,25 29,47 Z M12,42 L12,30 23,30 23,42 Z"/>
                      <path class="logo-letter-a" d=" M32,47 L32,34 49,34 49,30 32,30 32,25 54,25 54,47 Z M37,42 L37,39 49,39 49,42 Z"/>
                    </g>
                    <g class="logo-label" transform="translate(71, 22)">
                      <g class="logo-word-binary">
                        <path class="logo-label-letter-b" transform="translate(0, 0)" d=" M0,25 L0,0 5,0 5,7 20,7 20,25 Z M5,21 L5,11 15,11 15,21 Z"/>
                        <path class="logo-label-letter-i" transform="translate(22, 0)" d=" M0,25 L0,7 5,7 5,25 Z M0,3 L5,3 5,0 0,0 Z"/>
                        <path class="logo-label-letter-n" transform="translate(29, 0)" d=" M0,25 L0,7 20,7 20,25 15,25 15,11 5,11 5,25 Z"/>
                        <path class="logo-label-letter-a" transform="translate(51, 0)" d=" M0,25 L0,14 15,14 15,11 0,11 0,7 20,7 20,25 Z M5,21 L5,18 15,18 15,21 Z"/>
                        <path class="logo-label-letter-r" transform="translate(73, 0)" d=" M0,25 L0,7 20,7 20,11 5,11 5,25 Z"/>
                        <path class="logo-label-letter-y" transform="translate(95, 0)" d=" M0,25 L0,7 5,7 5,21 15,21 15,7 20,7 20,32 0,32 0,28 15,28 15,25 Z"/>
                      </g>
                      <g class="logo-word-age" transform="translate(118, 0)">
                        <path class="logo-label-letter-a" transform="translate(0, 0)" d=" M0,25 L0,14 15,14 15,11 0,11 0,7 20,7 20,25 Z M5,21 L5,18 15,18 15,21 Z"/>
                        <path class="logo-label-letter-g" transform="translate(22, 0)" d=" M0,25 L0,7 20,7 20,32 0,32 0,28 15,28 15,25 Z M5,21 L5,11 15,11 15,21 Z"/>
                        <path class="logo-label-letter-e" transform="translate(44, 0)" d=" M0,25 L0,7 20,7 20,18 5,18 5,21 20,21 20,25 Z M5,14 L5,11 15,11 15,14 Z"/>
                      </g>
                    </g>
                  </svg>
                </div>
              </a>
            </div>
            <div class="relativize">
              <ul class="header-menu menu-selected-products">
                <li class="menu-item-store"><a href="https://sites.fastspring.com/binaryage/product/store"><i class="fa fa-shopping-cart"></i><span>store</span></a></li>
                <li class="menu-item-products"><a href="//www.binaryage.com"><i class="fa fa-star"></i><span>products</span></a></li>
                <li class="menu-item-blog"><a href="//blog.binaryage.com"><i class="fa fa-bullhorn"></i><span>blog</span></a></li>
                <li class="menu-item-support"><a href="//discuss.binaryage.com"><i class="fa fa-comments"></i><span>support</span></a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="main" class="cf">
      <div class="doc-content markdown-body markdown-tweaks">
        <div class="container">
          <div class="row">
            <div class="col-md-12 doc-header">
              <p><a href="/" class="doc-back-link"><img src="https://static.binaryage.com/4029a862_shared_img_icons_totalfinder-64.png"/><span>TotalFinder homepage ↑</span></a></p>
            </div>
          </div>
          <div class="row">
            <div class="col-md-3">
              <div class="sidebar">
                <div class="content-sidebar">
                  <h2>Change log</h2>
                  <ul>
                    <li><a href="/changes" data-alt="/beta-changes">Recent changes</a></li>
                  </ul>
                  <h2>Before installing</h2>
                  <ul>
                    <li><a href="/about">About TotalFinder</a></li>
                    <li><a href="/installation">Installation</a></li>
                    <li><a href="/uninstallation">Uninstallation</a></li>
                    <li><a href="/licensing">Licensing</a></li>
                    <li><a href="/purchasing">Purchasing</a></li>
                    <li><a href="/registration">Registration</a></li>
                  </ul>
                  <h2>Features</h2>
                  <ul>
                    <li><a href="/tabs">Tabs</a></li>
                    <li><a href="/dual-mode">Dual mode</a></li>
                    <li><a href="/visor">Visor</a></li>
                    <li><a href="/show-system-files">Show system files</a></li>
                    <li><a href="/colored-labels">Colored Labels</a></li>
                    <li><a href="/folders-on-top">Folders on top</a></li>
                    <li><a href="/menus">Context Menus</a></li>
                    <li><a href="/tweaks">Other Tweaks</a></li>
                  </ul>
                  <h2>More</h2>
                  <ul>
                    <li><a href="/compatibility">Compatibility</a></li>
                    <li><a href="/sip">System Integrity Protection</a></li>
                    <li><a href="/reasons-to-buy">Reasons to buy</a></li>
                    <li><a href="/free-licenses">Free licenses</a></li>
                    <li><a href="/credits">Credits</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="col-md-9">
              <div class="doc-page">
                <div class="header-content">
                  <h1 class="title">Troubles launching TotalFinder</h1>
                </div>
                <div class="generic-separator"></div>
                <div class="page-content">
                  <p>I guess you are visiting this page because you just saw this notification:</p>
                  <p><img src="https://static.binaryage.com/8fbae4e8_images_totalfinder-injection-troubles-notification.png" class="no-background" style="width:400px" alt="Notification: Troubles launching TotalFinder - Apple Events cannot be delivered"/><br/></p>
                  <p><a href="/automation-permissions">TotalFinder needs to send Apple Events</a> to inject own code into running Finder.app and then successfully take control
                  over it. Unfortunately this failed on your machine for some reason.</p>
                  <h2 id="have-you-tried-turning-it-off-and-on-again">Have you tried turning it off and on again?</h2>
                  <p>In Terminal.app, please reset privacy settings the system has remembered about TotalFinder:</p>
                  <pre class="terminal">tccutil reset AppleEvents com.binaryage.totalfinder.agent</pre>
                  <p>Then please:</p>
                  <ol>
                    <li>Force Quit Finder.app via CMD+OPT+ESC.</li>
                    <li>Launch <code class="language-plaintext highlighter-rouge">/Applications/TotalFinder.app</code> again.</li>
                  </ol>
                  <p>This should trigger another attempt to inject TotalFinder into Finder. You should be presented with:</p>
                  <p><img src="https://static.binaryage.com/bde4985e_images_totalfinder-permission-prompt.png" class="no-background" style="width:400px" alt="TotalFinder permission prompt"/><br/></p>
                  <p>Press OK, to allow this. TotalFinder then should start working. E.g. you should see TotalFinder’s menubar icon.</p>
                  <p>Didn’t work? Ah, not good…</p>
                  <h2 id="a-bit-of-historical-context">A bit of historical context</h2>
                  <p>In the old days when TotalFinder was first written macOS was pretty unrestricted. Apps could talk to each other freely.
                    It was flexible but potentially unsecure. Over time Apple devs started adding various ways how to harden the system.
                  In recent macOS versions user has to grant permissions to TotalFinder to be able to talk to Finder using Apple Events.</p>
                  <p>This plan to harden the OS sounds good in theory but how to keep backward compatibility?</p>
                  <ol>
                    <li>obviously there are many apps doing various things in various ways
                    =&gt; Apple devs must cover all such cases including weird corner cases</li>
                    <li>rogue apps could abuse security prompts, trigger them repeatedly and nag users into submission
                    =&gt; Apple devs must somehow present prompts in a sane way and implement some heuristics to prevent such abuse</li>
                    <li>this security system gets pretty complex
                    =&gt; Apple devs are expected not to introduce bugs</li>
                  </ol>
                  <p>Unfortunately this wasn’t executed perfectly. If you are interested in technical details here are some articles
                  about this topic:</p>
                  <ol>
                    <li><a href="https://eclecticlight.co/2018/08/07/running-apps-with-mojaves-privacy-protection/">https://eclecticlight.co/2018/08/07/running-apps-with-mojaves-privacy-protection/</a></li>
                    <li><a href="https://www.felix-schwarz.org/blog/2018/06/apple-event-sandboxing-in-macos-mojave">https://www.felix-schwarz.org/blog/2018/06/apple-event-sandboxing-in-macos-mojave</a></li>
                    <li><a href="https://www.felix-schwarz.org/blog/2018/08/new-apple-event-apis-in-macos-mojave">https://www.felix-schwarz.org/blog/2018/08/new-apple-event-apis-in-macos-mojave</a></li>
                  </ol>
                  <p>TotalFinder has also own <a href="https://discuss.binaryage.com/t/totalfinder-does-not-launch">history of troubles</a>
                    trying to adapt to the changes Apple devs were introducing
                    and fighting their bugs while introducing our own bugs.
                  Software is not perfect, let’s troubleshoot it.</p>
                  <h2 id="troubleshooting">Troubleshooting</h2>
                  <h5 id="1-please-make-sure-you-are-running-latest-totalfinder-for-you-macos-version">1. please make sure you are running <a href="/compatibility">latest TotalFinder for you macOS version</a>.</h5>
                  <h5 id="2-please-look-into-system-preferences--security--privacy--privacy--automation">2. please look into <code class="language-plaintext highlighter-rouge">System Preferences &gt; Security &amp; Privacy &gt; Privacy &gt; Automation</code>.</h5>
                  <blockquote>
                    <p>You should see that <a href="/automation-permissions">TotalFinder is granted automation permissions to control Finder</a>.</p>
                  </blockquote>
                  <h5 id="3-what-if-there-is-no-mention-of-totalfinder">3. what if there is no mention of TotalFinder?</h5>
                  <blockquote>
                    <p>Well, sometimes this privacy subsystem gets into an unfortunate state. It thinks that it should prompt user for
                      permissions, and it also thinks it needs to prevent abuse, so it blocks any permission prompts. It also does not
                      offer any way how to tweak the permission from <code class="language-plaintext highlighter-rouge">Security &amp; Privacy</code> UI.
                    Usually this ban on permission prompts is time-based. So it should expire after some time. Maybe?!</p>
                    <p>TotalFinder versions 1.13.0 up to 1.13.7 were affected by this. Later I found <a href="https://github.com/desktop/desktop/issues/9050#issue-560018947">the real cause of this issue</a>.
                    TotalFinder version 1.13.8 and up should not be affected.</p>
                    <p>Other possibility is that the permission database is somehow borked. I believe that macOS 10.15 (Mojave) <a href="https://github.com/Hammerspoon/hammerspoon/issues/2031#issuecomment-478250239">had issues with this</a>.
                    I would recommend resetting it from command-line:</p>
                  </blockquote>
                  <pre class="terminal">tccutil reset AppleEvents</pre>
                  <blockquote>
                    <p>If that does not help, you might consider resetting all privacy decisions:</p>
                  </blockquote>
                  <pre class="terminal">tccutil reset All</pre>
                  <blockquote>
                    <p>btw. To see manual pages of <code class="language-plaintext highlighter-rouge">tccutil</code> you can run:</p>
                  </blockquote>
                  <pre class="terminal">man tccutil</pre>
                  <blockquote>
                    <p>I’m not sure if you need to kill any processes for this to take effect, better do it:</p>
                  </blockquote>
                  <pre class="terminal">killall TotalFinder; killall Finder</pre>
                  <blockquote>
                    <p>Or better reboot your computer according to <a href="https://eclecticlight.co/2018/11/20/what-does-the-tcc-compatibility-database-do/">this article</a>.</p>
                  </blockquote>
                  <pre class="terminal">sudo reboot</pre>
                  <blockquote>
                    <p>Didn’t help? Since you already have disabled the SIP,
                    there is one last brutal way how to nuke broken privacy database</p>
                  </blockquote>
                  <pre class="terminal">sudo rm "/Library/Application Support/com.apple.TCC/TCC.db"</pre>
                  <blockquote>
                    <p>Then immediately reboot your computer. At least this <a href="https://community.folivora.ai/t/bug-cant-add-btt-to-mojave-privacy-security-settings/6688/2">has worked to some people on the interwebs</a>.</p>
                  </blockquote>
                  <h5 id="4-rebooted-and-no-success-what-next">4. rebooted and no success, what next?</h5>
                  <blockquote>
                    <p>Please email me at <a href="mailto:support@binaryage.com">support@binaryage.com</a>. We can continue there.</p>
                  </blockquote>
                  <script>defer$(function(){$(function(){$(".doc-image").wrap(function(){return $("<a class='wrapped-doc-image' data-fancybox-group='doc'></div>").attr("href",$(this).attr("src")).attr("title",$(this).attr("title"))}),$(".wrapped-doc-image").fancybox()})})</script>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <script>defer$(function(){$(function(){setTimeout(function(){var a=document.location.pathname+"";$('.sidebar a[href*="'+a+'"]').parent().addClass("selected"),$('.sidebar a[data-alt*="'+a+'"]').parent().addClass("selected")},100)})})</script>
    </div>
    <div id="footer">
      <div class="container">
        <div class="row">
          <div class="col-md-8">
          </div>
          <div class="col-md-4">
            <div class="footer-box-right">
              <div class="footer-copyright">
                <div class="footer-license">
                  <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0"><img title="the website license" alt="Creative Commons License" style="border-width:0" src="https://static.binaryage.com/69a4ba35_shared_img_byccnd.png"/></a>
                </div>
                <a href="https://www.binaryage.com/about">BinaryAge</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="https://static.binaryage.com/bb6250cd_shared_js_code.js"></script>
    <script type="text/javascript">window.ga=function(){}</script>
    <script>window.ga=undefined,function(e,n,a,t,i,o,c){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,o=n.createElement(a),c=n.getElementsByTagName(a)[0],o.async=1,o.src=t,c.parentNode.insertBefore(o,c)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-8404259-1","auto",{allowLinker:!0}),ga("send","pageview"),ga("require","linker"),ga("linker:autoLink",["fastspring.com"],!0)</script>
    <script type="text/javascript" charset="utf-8">defer$(function(){$(function(){setTimeout(function(){var i=location.hash.substring(1);"o-"==i.substring(0,2)&&$("#"+i).trigger("click")},500)})})</script>
    <script type="text/javascript" charset="utf-8">defer$(function(){$("p,pre,ul,ol,h2,h3,h4,h5,h6,.anchorable").addClass("add-anchor");var n='<svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/></path> </svg>',e=function(e){for(var a=e.split(","),i=[],t=0;t<a.length;t++){var r=a[t];i.push(r+" .add-anchor")}return i.join(",")}(".page-content"),a=$(e);a.not(a.children()).each(function(){var e,a=$(this);if(e&&""!==e||(e=a.attr("id")||a.attr("title")||a.attr("src")),e&&""!==e||(e=a.text()),!e||""===e){var i=a.find(".doc-image").attr("src");if(i){var t=i.split(/[/_]/);if(0<t.length)e=t[t.length-1].replace(/[/.]/g," ")}}if(e&&""!==e){var r="mark-"+e.toLowerCase().replace(/[ _-]/g," ").replace(/^\s+/g,"").split(" ",10).join("D").replace(/\W/g,"").replace(/D+/g,"-").replace(/^-+/g,"").replace(/-+$/g,"");a.prepend('<a id="'+r+'" href="#'+r+'" class="anchor" aria-hidden="true">'+n+"</a>")}});var i=function(e){$(".highlighted-section").removeClass("highlighted-section");var a="#"+e;"#"!=a&&$(a).parent().addClass("highlighted-section")},t=function(){return window.location.hash.slice(1)};$(window).on("hashchange",function(){i(t())}),i(t())})</script>
  </body>
</html>